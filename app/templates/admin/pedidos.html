{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>Pedidos - Administração</h2>
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>ID</th>
          <th>Data</th>
          <th>Cliente</th>
          <th>Total</th>
          <th>Status</th>
          <th>Atualizar</th>
        </tr>
      </thead>
      <tbody>
        {% for p in pedidos %}
        <tr>
          <td>{{ p.id }}</td>
          <td>{{ p.data.strftime('%d/%m/%Y %H:%M') }}</td>
          <td>{{ p.cliente.nome }}</td>
          <td>R$ {{ p.total|round(2) }}</td>
          <td>
            {% set status_map = {
              'Aguardando confirmação': 'warning',
              'Em preparação': 'info',
              'Pronto para retirada/entrega': 'primary',
              'Concluído': 'success',
              'Cancelado': 'danger'
            } %}
            {% set badge_class = status_map.get(p.status, 'secondary') %}
            <span class="badge badge-{{ badge_class }}">{{ p.status }}</span>
          </td>
          <td>
            <form method="post" action="{{ url_for('admin.atualizar_status_pedido', pedido_id=p.id) }}" class="d-flex gap-2">
              <select name="status" class="form-select form-select-sm" style="width: auto;">
                {% set statuses = ['Aguardando confirmação','Em preparação','Pronto para retirada/entrega','Concluído','Cancelado'] %}
                {% for s in statuses %}
                <option value="{{ s }}" {% if s == p.status %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
              </select>
              <button type="submit" class="btn btn-sm btn-primary ml-2">Salvar</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
