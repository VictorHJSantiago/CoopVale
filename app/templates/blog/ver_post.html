{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>{{ post.titulo }}</h2>
  <p class="text-muted">{{ post.categoria|capitalize }} • {{ post.criado_em.strftime('%d/%m/%Y') }}</p>
  {% if post.imagem_capa %}
  <img src="{{ url_for('static', filename=post.imagem_capa) }}" class="img-fluid mb-3" alt="Imagem de capa">
  {% endif %}
  <div class="mb-4">{{ post.conteudo|safe }}</div>
  
  <hr>
  <h5>Comentários</h5>
  {% if comentarios %}
  <div class="list-group mb-3">
    {% for c in comentarios %}
    <div class="list-group-item">
      <div class="d-flex w-100 justify-content-between">
        <strong>{{ c.usuario.email }}</strong>
        <small>{{ c.criado_em.strftime('%d/%m/%Y %H:%M') }}</small>
      </div>
      <p class="mb-1">{{ c.comentario }}</p>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info">Nenhum comentário ainda.</div>
  {% endif %}
  
  {% if current_user.is_authenticated %}
  <form method="POST" action="{{ url_for('blog.adicionar_comentario', slug=post.slug) }}" class="mb-4">
    <div class="mb-3">
      <label for="comentario" class="form-label">Adicionar Comentário</label>
      <textarea class="form-control" id="comentario" name="comentario" rows="3" required></textarea>
    </div>
    <button type="submit" class="btn btn-success">Enviar</button>
  </form>
  {% else %}
  <p><a href="{{ url_for('auth.login') }}">Faça login</a> para comentar.</p>
  {% endif %}
  
  <a href="{{ url_for('blog.index') }}" class="btn btn-secondary">Voltar</a>
</div>
{% endblock %}