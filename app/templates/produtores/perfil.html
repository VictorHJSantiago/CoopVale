{% extends 'base.html' %}
{% block title %}Perfil do Produtor{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="row g-4">
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm">
        {% set foto = produtor.fotos.split(',')[0] if produtor.fotos %}
        <img src="{{ url_for('static', filename=foto if foto else 'images/placeholders/produtor.svg') }}" class="card-img-top" alt="{{ produtor.nome }}">
        <div class="card-body">
          <h4 class="card-title mb-1">{{ produtor.nome }}</h4>
          {% if produtor.certificacoes %}<span class="badge bg-success">Certificado</span>{% endif %}
          {% if produtor.endereco %}<p class="mt-2 text-muted">{{ produtor.endereco }}</p>{% endif %}
          {% if produtor.telefone %}<p class="mb-0"><strong>Telefone:</strong> {{ produtor.telefone }}</p>{% endif %}
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Sobre o produtor</h5>
          <p>{{ produtor.descricao or 'Produtor ainda não adicionou uma descrição.' }}</p>
        </div>
      </div>
      <div class="mt-4">
        <h5 class="mb-3">Produtos do produtor</h5>
        {% if produtos %}
        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3">
          {% for produto in produtos %}
          <div class="col">
            <div class="card h-100">
              {% set img = (produto.imagens.split(',')[0] if produto.imagens) %}
              <img src="{{ url_for('static', filename=img if img else 'images/placeholders/produto.jpg') }}" class="card-img-top" alt="{{ produto.nome }}">
              <div class="card-body d-flex flex-column">
                <h6 class="card-title">{{ produto.nome }}</h6>
                <p class="small text-muted mb-2">{{ produto.unidade }} · R$ {{ '%.2f'|format(produto.preco) }}</p>
                <a href="{{ url_for('produtos_bp.detalhe', produto_id=produto.id) }}" class="btn btn-outline-primary btn-sm mt-auto">Ver detalhes</a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">Este produtor ainda não cadastrou produtos.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}